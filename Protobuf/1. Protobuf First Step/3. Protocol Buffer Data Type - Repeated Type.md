# Protocol Buffer Data Type - Repeated Type, Oneof Type, Map Type

---

- Authro: Hoplin

---

## Repeated Type

`Repeated Type`은 `배열 데이터를 표현할때 사용하는 타입`이다. `Repeated Type`의 표기는 `repeated`로 표기하며, 선언 방식은 아래와 같다. `Repeated Type`은 혼자서 사용될 수 없으며, 특정 자료형과 함께 사용되는 타입이다.(프로그래밍 언어에서 `~형 배열`처럼 특정 자료형과 함께 쓰임)

```proto
repeated (Data Type) (Field Name) = (Tag);
```

`Repeated Type`는 0개 이상의 데이터를 가질 수 있으며, default value는 빈 배열이 된다.

### 간단 연습

[2. Protocol Buffer Data Type - Scalar Type](./2.%20Protocol%20Buffer%20Data%20Type%20-%20Scalar%20Type.md)에서 마지막에 진행한 `간단 연습`의 문제의 연장이다. 추가적인 요구사항이 들어왔다고 가정한다.

- 사용자의 소비 패턴에 대한 해시태그들을 저장해야함

```proto
message Account {
    string id = 1;
    string name = 2;
    uint64 balance = 3;
    bool hasLoan = 4;
    bytes profileImage = 5;
    repeated string hashtags = 6;
}
```

## Oneof Type

`Oneof Type`은 여러개의 값 중 하나의 값만 전달할때 사용하는 타입이다. `Oneof Type`은 **`oneof` 키워드로 정의할 수 있으며 선택할 수 있는 필드들을 정의한다(`message`의 필드와 동일한 형태). `repeated` 타입은 `oneof`타입과 함께 사용할 수 없다.**

```proto
oneof (Oneof type field name){
    (data type) (field name) = (tag);
    // Same
}
```

```proto
oneof OneofType {
    string name = 1;
    uint32 age = 2;
}
```

한가지 더 주의할 점은 **`oneof`타입의 필드로는 `repeated`와 `map` 타입이 올 수 없다.** 만약 `repeated` 혹은 `map`을 꼭 넣어야 한다면 `Nested Message`(추후 볼 것이다)형태로 필드를 정의할 수 있다.

```proto
syntax = "proto3";


message OneofTest{
    message NestedRepeated {
        repeated string hashtags = 1;
    }

    message NestedMap {
        map<string,uint32> hashtable = 1;
    }
    oneof OneofField {
        NestedRepeated repeatedField = 1;
        NestedMap mapField = 2;
    }
}
```

`oneof`타입은 앞에서도 말했듯이 정의된 필드중 하나를 선택하는 형식이다. 만약 프로그래밍 언어 레벨에서 여러번의 Oneof필드에 값을 대입했다면, 가장 마지막에 정의된 필드의 값으로 Serialize 되게 된다.
